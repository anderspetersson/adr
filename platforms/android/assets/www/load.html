<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ratchet template page</title>

    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">

    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- Include the compiled Ratchet CSS -->
    <link href="css/ratchet.css" rel="stylesheet">
    <script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>

  </head>
  <body>


    <!-- Make sure all your bars are the first things in your <body> -->
    <header class="bar bar-nav">
      <a class="icon icon-left-nav pull-left" href="index.html"></a>
      <h1 class="title"></h1>
    </header>

    <nav class="bar bar-tab">
      <a class="tab-item active" href="index.html">
        <span class="icon icon-bars"></span>
        <span class="tab-label">Ämnen</span>
      </a>
      <a class="tab-item" href="declaration.html">
        <span class="icon icon-compose"></span>
        <span class="tab-label">Deklaration</span>
      </a>
      <a class="tab-item" href="#">
        <span class="icon icon-star-filled"></span>
        <span class="tab-label">Favorites</span>
      </a>
      <a class="tab-item" href="#">
        <span class="icon icon-gear"></span>
        <span class="tab-label">Settings</span>
      </a>
    </nav>

    <nav class="bar bar-tab">
      <a class="tab-item active" href="index.html">
        <span class="icon icon-bars"></span>
        <span class="tab-label">Ämnen</span>
      </a>
      <a id="declarationlink" class="tab-item" href="declaration.html">
        <span class="icon icon-compose"></span>
        <span class="tab-label">Deklaration</span>
      </a>
      <a class="tab-item" href="#">
        <span class="icon icon-star-filled"></span>
        <span class="tab-label">Favorites</span>
      </a>
      <a class="tab-item" href="#">
        <span class="icon icon-gear"></span>
        <span class="tab-label">Settings</span>
      </a>
    </nav>

    <!-- Wrap all non-bar HTML in the .content div (this is actually what scrolls) -->
    <div class="content">
        <form class="input-group" name="loadForm">
            <input class="input-lg" type="number" placeholder="Antal">
            <input type="submit" class="btn btn-primary btn-block btn-outlined" value="Lasta">
        </form>
        
        <script class="js-custom">
          id = getURLParameter('id');
          $.getJSON( "http://10.0.1.4:8000/api/substances/" + id + "/?format=json", function( data ) {
            title = data.title;
            un = data.un;
            description = data.description;
            class_code = data.class_code;
            tunnel_code = data.tunnel_code;


            $('.title').text(title);
            $('form[name=loadForm]').submit(function(e){
                e.preventDefault();
                number = $('input[type=number]').val();
                window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);

                function gotFS(fileSystem) {
                    fileSystem.root.getFile("test2.txt", {create: true, exclusive: false}, gotFileEntry, fail);
                }

                function gotFileEntry(fileEntry) {
                    entry = fileEntry
                    entry.file(getFileContent, fail);
                }

                function getFileContent(file){
                    var reader = new FileReader();
                    reader.onloadend = function (evt) {
                        json = JSON.parse(evt.target.result);
                        entry.createWriter(gotFileWriter, fail);
                    };
                    reader.readAsText(file);
                }

                function gotFileWriter(writer) {
                    json.push({'title': title, 'un': un, 'description': description,
                        'class_code': class_code, 'tunnel_code': tunnel_code, 'number': number})
                    writer.write(json);
                }

                function fail(error) {
                    console.log(error.code);
                }
            });
          });
        </script>
    </div>

  </body>
</html>
